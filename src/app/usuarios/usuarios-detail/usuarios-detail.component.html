<div class="layout-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-brand">
        <svg class="sidebar-brand-icon" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
          <ellipse cx="9" cy="10" rx="1" ry="1.5" fill="currentColor"/>
          <ellipse cx="15" cy="10" rx="1" ry="1.5" fill="currentColor"/>
          <path d="M8 15 Q12 18 16 15" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
        <span class="sidebar-brand-text">MD Research</span>
      </div>
      <hr class="sidebar-divider">

      <!-- Saludo y rol del usuario -->
      <div class="user-welcome">
        <h3 class="user-greeting">Hola, {{ obtenerNombreUsuario() }}</h3>
        <p class="user-role">{{ obtenerRolUsuario() }}</p>
      </div>
      <hr class="sidebar-divider">
    </div>
    <nav>
      <div class="sidebar-heading">Módulos</div>
      <ul>
        @for (modulo of modulos(); track modulo.llave) {
          <li
            class="sidebar-item"
            [class.active]="esModuloActivo(modulo.ruta!)"
            (click)="navegarAModulo(modulo.ruta!)">
            {{ modulo.valor }}
          </li>
        }
        @empty {
          <li class="sidebar-item disabled">No hay módulos disponibles</li>
        }
        @if (esAdministrador()) {
          <li class="sidebar-item" (click)="navegarACargaMasiva()">
            Carga Masiva
          </li>
        }
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="usuarios-page">
      <!-- Header -->
      <div class="page-header">
        <div class="header-title">
          <h1>Detalle de Usuario</h1>
          <button class="btn-secondary" (click)="volverALista()">Volver a la lista</button>
        </div>
        <div class="header-actions">
          <!-- Menú de usuario -->
          <div class="user-menu-container">
            <button class="user-menu-trigger" (click)="toggleMenuUsuario()">
              <div class="user-avatar-menu">{{ obtenerInicialesUsuario() }}</div>
            </button>

            @if (mostrarMenuUsuario()) {
              <div class="user-dropdown">
                <div class="user-dropdown-header">
                  <div class="user-dropdown-badge">{{ obtenerInicialesUsuario() }}</div>
                  <div class="user-dropdown-info">
                    <div class="user-dropdown-name">{{ obtenerNombreCompletoUsuario() }}</div>
                    <div class="user-dropdown-email">{{ obtenerEmailUsuario() }}</div>
                  </div>
                </div>
                <hr class="user-dropdown-divider">
                <button class="user-dropdown-item" (click)="cerrarSesion()">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  Cerrar sesión
                </button>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="cargando()" class="loading">
        <p>Cargando detalle del usuario...</p>
      </div>

      <!-- Error -->
      <div *ngIf="!cargando() && error()" class="error-message">
        {{ error() }}
      </div>

      <!-- Detalle -->
      <div *ngIf="!cargando() && !error() && usuario()" class="card detail-card">
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">Nombre completo</span>
            <span class="detail-value">{{ obtenerNombreCompleto(usuario()!) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Usuario</span>
            <span class="detail-value">{{ usuario()!.username }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">UUID</span>
            <span class="detail-value">{{ usuario()!.userUuid }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">ID interno</span>
            <span class="detail-value">{{ usuario()!.userId }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Documento</span>
            <span class="detail-value">
              {{ usuario()!.tipodoc }} - {{ usuario()!.numdoc }}
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Estado</span>
            <span class="detail-value">
              <span [class]="obtenerEstadoClass(usuario()!)">
                {{ obtenerEstadoTexto(usuario()!) }}
              </span>
            </span>
          </div>
          <div class="detail-item detail-item-full">
            <span class="detail-label">Roles</span>
            <span class="detail-value">
              @if (usuario()!.roles.length) {
                <span class="detail-roles">
                  @for (rol of usuario()!.roles; track rol.rolId) {
                    <span class="badge-rol">{{ rol.descripcion }}</span>
                  }
                </span>
              } @else {
                <span class="text-muted">Sin rol</span>
              }
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Fecha creación</span>
            <span class="detail-value">
              {{ usuario()!.fechaCreacion | date:'dd/MM/yyyy HH:mm' }}
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Usuario creación</span>
            <span class="detail-value">{{ usuario()!.usuarioCreacion }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Fecha modificación</span>
            <span class="detail-value">
              {{ usuario()!.fechaModificacion | date:'dd/MM/yyyy HH:mm' }}
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Usuario modificación</span>
            <span class="detail-value">{{ usuario()!.usuarioModificacion }}</span>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
